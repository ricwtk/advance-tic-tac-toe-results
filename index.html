<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdn.materialdesignicons.com/3.6.95/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:200,400,700"> 
    <link rel="stylesheet" href="./main.css">
  </head>
  <body>
    <div id="app">
      <div class="screen" id="left-panel">
        <div class="screen" id="tournament-view">
          <div class="screen-head">Tournament</div>
          <div class="text-button" title="open scoreboard" @click="showing_scoreboard = true">
            <div class="mdi mdi-view-dashboard-variant"></div><div>Scoreboard</div>
          </div>
          <div v-if="main_player !== ''" id="main-team-wrapper" :title="players[main_player].name">
            <div class="team" id="main-team"><div>{{ players[main_player].name }}</div><div :class="['mdi', 'mdi-' + players[main_player].icon]"></div></div>
          </div>
          <div class="screen" id="opponents" v-if="main_player !== ''">
            <div v-for="k,i in player_keys_in_order" class="opponent" v-if="k != main_player">
              <div :class="['team-block', 'mdi', 'mdi-'+players[k].icon]" :title="players[k].name"></div>
              <div 
                :class="['result-block', 'mdi'].concat(scores[k][main_player] == 0 ? ['win', 'mdi-thumb-up-outline'] : scores[k][main_player] == 1 ? ['lose', 'mdi-thumb-down-outline'] : scores[k][main_player] == 2 ? ['tie', 'mdi-thumbs-up-down'] : ['yet', 'mdi-help'] )"
                :title="scores[k][main_player] == 0 ? players[main_player].name + ' win' : scores[k][main_player] == 1 ? players[main_player].name + ' lose' : scores[k][main_player] == 2 ? 'tie' : '?'"
                @click="setGame(k,main_player)"></div>
              <div
                :class="['result-block', 'mdi'].concat(scores[main_player][k] == 1 ? ['win', 'mdi-thumb-up-outline'] : scores[main_player][k] == 0 ? ['lose', 'mdi-thumb-down-outline'] : scores[main_player][k] == 2 ? ['tie', 'mdi-thumbs-up-down'] : ['yet', 'mdi-help'] )"
                :title="scores[main_player][k] == 1 ? players[main_player].name + ' win' : scores[main_player][k] == 0 ? players[main_player].name + ' lose' : scores[main_player][k] == 2 ? 'tie' : '?'"
                @click="setGame(main_player,k)"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="screen" id="main-content">
        <!-- <div class="message" v-show="winning_player.length > 0">
          Player&nbsp;<div :class="['mdi', 'mdi-' + ((winning_player.length > 0) ? players[play[winning_player[0].n]].icon : '')]"></div>&nbsp;won!
        </div>
        <div class="message" v-show="tie">
          It's a tie!
        </div>
        <div class="message hide" v-show="!tie && !(winning_player.length > 0)">
          Placeholder
        </div> -->
        <div id="game-pad">
          <div class="squarerow">
            <div class="square"></div>
            <div :class="['square', 'mdi', 'mdi-alpha-' + String.fromCharCode(97 + s) + '-box']" v-for="s in [...Array(grid_size).keys()]"></div>
          </div>
          <div class="squarerow" v-for="r in [...Array(grid_size).keys()]">
            <div :class="['square', 'mdi', 'mdi-numeric-' + r + '-box']"></div>
            <div :class="['square', 'mdi', (s == -1) ? '' : s == 0 ? 'mdi-'+players[game.first_player].icon : 'mdi-'+players[game.second_player].icon ]" v-for="(s,i) in squares.slice(r*grid_size,r*grid_size+grid_size)"></div>
          </div>
        </div>
        <div id="controls">
          <!-- <div v-if="players.length > 0" v-for="p in play" :key="p" :class="['player-block', (play[currentplayer] == p) ? 'selected' : '', 'mdi', 'mdi-' + players[p].icon]"></div> -->
          <!-- <div class="mdi mdi-plus control-block" @click="choosing_player = true" title="add player"></div> -->
          <!-- <div class="mdi mdi-minus control-block" @click="player.pop()" title="remove last player"></div> -->
          <!-- <div class="mdi mdi-playlist-plus control-block" @click="changeGrid(1)" title="increase grid by 1"></div> -->
          <!-- <div class="mdi mdi-playlist-minus control-block" @click="changeGrid(-1)" title="reduce grid by 1"></div> -->
          <!-- <div class="mdi mdi-account-switch control-block" @click="switchPlayer" title="skip to next player"></div> -->
          <!-- <div class="mdi mdi-eraser control-block" @click="clearBoard" title="clear game board"></div> -->
          <!-- <div :class="['mdi', 'control-block', 'mdi-numeric-2-box-outline', additional_rule ? 'selected' : 'unselected']" @click="additional_rule = !additional_rule" title="toggle additional rule"></div> -->
          <!-- <div class="mdi mdi-account-group-outline control-block" @click="setting_player = true" title="choose players"></div> -->
          <!-- <div class="mdi mdi-play-speed control-block" @click="triggerStart" title="trigger start"></div> -->
          <!-- <div class="mdi mdi-view-dashboard-variant control-block" @click="showing_scoreboard = !showing_scoreboard" :title="showing_scoreboard ? 'hide scoreboard' : 'show scoreboard'"></div> -->
          <!-- <div :class="['mdi', 'control-block', tournament_initiated ? 'mdi-pause' : 'mdi-play']" @click="toggleTournament" :title="tournament_initiated ? 'pause tournament after this' : 'start tournament'"></div> -->
          <!-- <div class="mdi mdi-backup-restore control-block" @click="resetTournament" title="reset tournament"></div> -->
          <div :class="[ 'mdi', 'mdi-skip-previous', 'control-block', show_move <= 0 ? 'unselected' : '' ]" title="last move" @click="show_move = Math.max(0, show_move - 1)"></div>
          <div class="mdi mdi-play control-block" title="playback"></div>
          <div :class="[ 'mdi', 'mdi-skip-next', 'control-block', show_move >= game.moves.length ? 'unselected' : '' ]" title="next move" @click="show_move = Math.min(game.moves.length, show_move + 1)"></div>
          <div class="mdi mdi-restore control-block" title="clear board" @click="show_move = 0"></div>
          <div class="mdi mdi-settings control-block" title="playback setting"></div>
        </div>
      </div>

      <div class="screen" id="side-panel">
        <div class="screen" id="current-game">
          <div class="screen-head">Current game</div>
          <div class="screen" id="current-game-content">
            <div id="current-game-info" v-if="game.first_player !== ''">
              <div :class="['team-block', 'mdi', 'mdi-' + players[game.first_player].icon]"></div>&nbsp;vs&nbsp;<div :class="['team-block', 'mdi', 'mdi-' + players[game.second_player].icon]"></div>
            </div>
            <div id="current-game-result" v-if="game.first_player !== ''">
              <template v-if="game.result.tie">
                tie
              </template>
              <template v-else>
                <div :class="['mdi', 'mdi-' + (game.result.win ? players[game.first_player].icon : players[game.second_player].icon) ]"></div>
                &nbsp;<div>wins</div>
              </template>
            </div>
          </div>
        </div>
        <div class="screen" id="game-moves">
          <div class="screen-head">Moves</div>
          <div class="screen" id="game-moves-content">
            <div v-for="m,i in game.moves" class="game-move" @click="show_move = i+1">
              <div :class="['team-block', 'mdi', 'mdi-' + (i%2 == 0 ? players[game.first_player].icon : players[game.second_player].icon) ]"></div>
              <div :class="['move-block', 'mdi', 'mdi-numeric-' + Math.floor(m/grid_size) + '-box' ]"></div>
              <div :class="['move-block', 'mdi', 'mdi-alpha-' + String.fromCharCode(97 + m%grid_size) + '-box' ]"></div>
            </div>
          </div>
        </div>
        <!-- <div class="screen" id="game-info-list">
          <div class="screen-head">Game info</div>
          <div class="screen" id="game-info-content">
            <div v-for="v,k in game_info" class="game-info-row">
              <div class="game-info-key">{{ k }}</div>
              <div class="game-info-value" v-html="v"></div>
            </div>
          </div>
        </div> -->
        <!-- <div class="screen" id="log-list">
          <div class="screen-head">Log</div>
          <div class="screen" id="log-content">
              <div v-for="l in log" class="log-msg" v-html="l"></div>
          </div>
        </div> -->
      </div>

      <div class="overlay" id="scoreboard-overlay" v-show="showing_scoreboard">
        <div class="overlay-box">
          <div class="overlay-title">
            Scoreboard
          </div>
          <div class="overlay-content">
            <table id="scoreboard" v-if="player_number > 0">
              <tr>
                <td></td>
                <td></td>
                <td :colspan="player_number" class="mdi mdi-numeric-2-box-outline"></td>
              </tr>
              <tr>
                <td></td>
                <td></td>
                <td v-for="k in player_keys_in_order" class="score-team-label"><div :class="['mdi', 'mdi-'+players[k].icon]"></div></td>
              </tr>
              <tr v-for="k,i in player_keys_in_order">
                <td v-if="i == 0" :rowspan="player_number" class="mdi mdi-numeric-1-box-outline"></td>
                <td class="score-team-label"><div :class="['mdi', 'mdi-'+players[k].icon]"></div></td>
                <td v-for="l,j in player_keys_in_order" :class="scores[k] ? scores[k][l] == 2 ? 'tie' : scores[k][l] == 1 ? 'win' : scores[k][l] == 0 ? 'lose' : 'yet' : 'yet'"
                  @mouseover="k == l ? setScoreHover('', '') : setScoreHover(k,l)"
                  @mouseleave="setScoreHover('','')"
                  @click="showGame(k,l)"
                ></td>
              </tr>
            </table>
          </div>
          <div id="score-text">
            <template v-if="score_hover_text.p1 !== ''">
              <div :class="['mdi', 'mdi-'+players[score_hover_text.p1].icon]"></div>&nbsp;{{ players[score_hover_text.p1].name }}
              &nbsp;vs&nbsp;
              <div :class="['mdi', 'mdi-'+players[score_hover_text.p2].icon]"></div>&nbsp;{{ players[score_hover_text.p2].name }}
              &nbsp;|&nbsp;
              <template v-if="[0,1].includes(scores[score_hover_text.p1][score_hover_text.p2])">
                <div :class="['mdi', 'mdi-'+players[scores[score_hover_text.p1][score_hover_text.p2] == 0 ? score_hover_text.p2 : score_hover_text.p1].icon]"></div>
                &nbsp;{{ players[scores[score_hover_text.p1][score_hover_text.p2] == 0 ? score_hover_text.p2 : score_hover_text.p1].name }}&nbsp;wins
              </template>
              <template v-else-if="scores[score_hover_text.p1][score_hover_text.p2] == 2">tie</template>
              <template v-else-if="scores[score_hover_text.p1][score_hover_text.p2] == -1">TBD</template>
            </template>
            <div>&nbsp;</div>
          </div>
          <div class="overlay-controls">
            <div class="control-block mdi mdi-close" @click="showing_scoreboard = false"></div>
          </div>
        </div>
      </div>
    </div>

    <script src="./main.js"></script>
  </body>
</html>